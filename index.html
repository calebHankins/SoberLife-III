<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧘 SoberLife - III 🧘</title>

    <!-- External CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
</head>

<body>
    <div class="game-container">
        <div class="game-header">
            <h1>🧘 SoberLife - III 🧘</h1>
            <button class="help-btn" id="helpBtn" onclick="showHelp()" aria-label="Show game help and instructions"
                tabindex="0">
                <span class="help-icon">?</span>
                <span class="help-text">Help</span>
            </button>
        </div>

        <!-- Avatar and Stress Meter -->
        <div class="avatar-container">
            <div class="avatar" id="avatar">😊</div>
            <div>
                <div>Stress Level</div>
                <div class="stress-meter">
                    <div class="stress-fill" id="stressFill"></div>
                </div>
                <div class="zen-points" id="zenPoints">Zen Points: 100</div>
            </div>
        </div>

        <!-- Game Mode Selection -->
        <div class="game-mode-selection" id="gameModeSelection">
            <h3>Choose Your Experience</h3>
            <p>How would you like to practice stress management?</p>

            <div class="mode-options">
                <div class="mode-card">
                    <h4>🏛️ Single Task Mode</h4>
                    <p>Practice with just the DMV scenario</p>
                    <button onclick="startSingleTaskMode()" class="mode-btn">Start DMV Challenge</button>
                </div>

                <div class="mode-card">
                    <h4>🎯 Campaign Mode</h4>
                    <p>Progress through multiple scenarios and upgrade your deck</p>
                    <button onclick="startCampaignMode()" class="mode-btn">Start Campaign</button>
                </div>
            </div>
        </div>

        <!-- Campaign Overview -->
        <div class="campaign-overview hidden" id="campaignOverview">
            <h2>🎯 Stress Management Campaign</h2>

            <div class="campaign-progress">
                <div class="deck-status">
                    <h4>🃏 Your Deck Power</h4>
                    <p id="deckComposition">Aces: 4 / 52 Cards</p>
                </div>
                <div class="total-progress">
                    <h4>📊 Campaign Progress</h4>
                    <p id="campaignProgress">Tasks Completed: 0/2</p>
                </div>
            </div>

            <div class="task-list" id="taskList">
                <!-- Task cards will be populated by JavaScript -->
            </div>

            <div class="campaign-actions">
                <button onclick="openCampaignShop()" class="primary-btn">🛒 Visit Shop</button>
                <button onclick="visitMindPalace()" class="secondary-btn">🧠 Visit Mind Palace</button>
                <button onclick="resetCampaign()" class="secondary-btn">Reset Campaign</button>
            </div>
        </div>

        <!-- Survey Section -->
        <div class="survey hidden" id="surveySection">
            <h3>Pre-Task Assessment</h3>
            <p id="surveyDescription">Before we begin your task, let's assess your current stress level:</p>

            <div class="survey-question">
                <strong>How did you sleep last night?</strong>
                <label><input type="radio" name="sleep" value="0"> Great! 8+ hours of solid sleep</label>
                <label><input type="radio" name="sleep" value="10"> Pretty well, 6-8 hours</label>
                <label><input type="radio" name="sleep" value="20"> Not great, 4-6 hours</label>
                <label><input type="radio" name="sleep" value="30"> Terrible, less than 4 hours</label>
            </div>

            <div class="survey-question">
                <strong id="preparedQuestion">How prepared do you feel for this task?</strong>
                <label><input type="radio" name="prepared" value="0"> Very prepared, ready to go</label>
                <label><input type="radio" name="prepared" value="10"> Mostly prepared</label>
                <label><input type="radio" name="prepared" value="20"> Somewhat prepared</label>
                <label><input type="radio" name="prepared" value="30"> Not prepared at all</label>
            </div>

            <div class="survey-question">
                <strong>How's your day been so far?</strong>
                <label><input type="radio" name="day" value="0"> Amazing, everything's going smoothly</label>
                <label><input type="radio" name="day" value="10"> Pretty good</label>
                <label><input type="radio" name="day" value="20"> Okay, some minor issues</label>
                <label><input type="radio" name="day" value="30"> Stressful, lots of problems</label>
            </div>

            <div id="surveyError" style="color: red; font-weight: bold; margin: 10px 0; display: none;">
                Please answer all questions before beginning your task!
            </div>
            <button id="startTaskBtn" onclick="startTask()" disabled>Begin Task</button>
        </div>

        <!-- Task Info -->
        <div class="task-info hidden" id="taskInfo">
            <div class="step-indicator" id="stepIndicator">Step 1 of 5</div>
            <h3>🏛️ Task: DMV License Renewal & Real ID</h3>
            <p id="taskDescription">Step 1: Check in at the front desk</p>
        </div>

        <!-- Zen Activities Panel -->
        <div class="zen-activities hidden" id="zenActivities">
            <h3>🧘 Stress Relief Activities</h3>
            <p>Use your zen points to manage stress during your task:</p>

            <!-- Activity Cooldown Status -->
            <div class="activity-status" id="activityStatus">
                <span class="activity-usage-indicator" id="activityUsageIndicator">
                    <span class="usage-count" id="activityUsageCount">0/1</span> activities used this hand
                </span>
            </div>

            <div class="activity-buttons">
                <!-- Default Activities -->
                <div class="activity-section">
                    <h4>Basic Techniques</h4>
                    <button class="activity-btn" onclick="useZenActivity('breath')" id="breathBtn">
                        🌬️ Deep Breath<br>
                        <small>10 zen points • -10% stress</small>
                    </button>
                    <button class="activity-btn" onclick="useZenActivity('stretch')" id="stretchBtn">
                        🤸 Quick Stretch<br>
                        <small>25 zen points • -20% stress</small>
                    </button>
                    <button class="activity-btn" onclick="useZenActivity('meditation')" id="meditationBtn">
                        🧘 Mini Meditation<br>
                        <small>50 zen points • -35% stress</small>
                    </button>
                </div>

                <!-- Premium Activities -->
                <div class="activity-section premium-activities" id="premiumActivitiesSection">
                    <h4>Advanced Techniques</h4>
                    <button class="activity-btn premium-activity" onclick="useZenActivity('mindfulBreathing')"
                        id="mindfulBreathingActivityBtn" style="display: none;">
                        🌸 Mindful Breathing<br>
                        <small>75 zen points • -50% stress</small>
                    </button>
                    <button class="activity-btn premium-activity reactive-activity"
                        onclick="useZenActivity('compartmentalize')" id="compartmentalizeActivityBtn"
                        style="display: none;">
                        🧠 Compartmentalize<br>
                        <small>100 zen points • Bust Recovery</small>
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area hidden" id="gameArea">
            <!-- Regular Game Display -->
            <div class="cards-container" id="regularCardsContainer">
                <div class="player-area">
                    <h3>You</h3>
                    <div class="cards" id="playerCards"></div>
                    <div class="score" id="playerScore">Score: 0</div>
                </div>
                <div class="house-area">
                    <h3>House</h3>
                    <div class="cards" id="houseCards"></div>
                    <div class="score" id="houseScore">Score: ?</div>
                </div>
            </div>

            <!-- Split Hand Display (for Compartmentalize) -->
            <div class="split-hands-container hidden" id="splitHandsContainer">
                <div class="split-hands-header">
                    <h3>🧠 Compartmentalized Hands</h3>
                    <div class="split-progress">
                        <span id="splitProgressText">Playing Hand 1 of 2</span>
                    </div>
                </div>

                <div class="split-hands-display">
                    <div class="split-hand" id="splitHand1">
                        <div class="split-hand-header">
                            <h4>Hand 1 <span class="hand-status" id="hand1Status"></span></h4>
                        </div>
                        <div class="cards" id="splitHand1Cards"></div>
                        <div class="score" id="splitHand1Score">Score: 0</div>
                    </div>

                    <div class="split-hand" id="splitHand2">
                        <div class="split-hand-header">
                            <h4>Hand 2 <span class="hand-status" id="hand2Status"></span></h4>
                        </div>
                        <div class="cards" id="splitHand2Cards"></div>
                        <div class="score" id="splitHand2Score">Score: 0</div>
                    </div>
                </div>

                <!-- Compact House display -->
                <div class="split-house-area">
                    <div class="split-house-info">
                        <h4>House <span id="splitHouseScore">Score: ?</span></h4>
                        <div class="cards" id="splitHouseCards"></div>
                    </div>
                </div>

                <div class="split-hand-controls">
                    <button id="switchHandBtn" onclick="switchSplitHandWrapper()" class="secondary-btn">Switch
                        Hand</button>
                    <button id="completeBothHandsBtn" onclick="completeBothHandsWrapper()"
                        class="primary-btn hidden">Complete Both</button>
                </div>
            </div>

            <div class="buttons">
                <button id="hitBtn" onclick="hit()">Hit</button>
                <button id="standBtn" onclick="stand()">Stand</button>
                <button id="nextStepBtn" onclick="nextStep()" class="hidden">Next Step</button>
            </div>

            <div id="roundResult"></div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over hidden" id="gameOverScreen">
            <div class="game-over-content">
                <div class="game-over-avatar">🤯</div>
                <h2>STRESS OVERLOAD!</h2>
                <p class="game-over-message" id="gameOverMessage">You've reached maximum stress levels and had a
                    complete meltdown!</p>
                <p class="game-over-subtext" id="gameOverSubtext">Don't worry, it happens to the best of us.</p>

                <div class="game-over-stats">
                    <p>Final Stress Level: <span id="finalStressLevel">100%</span></p>
                    <p>Zen Points Remaining: <span id="finalZenPoints">0</span></p>
                    <p>Steps Completed: <span id="stepsCompleted">0</span>/5</p>
                </div>

                <button id="tryAgainBtn" onclick="restartGame()">Try Again</button>
            </div>
        </div>

        <!-- Game Success Screen -->
        <div class="game-success hidden" id="gameSuccessScreen">
            <div class="game-success-content">
                <div class="game-success-avatar">🎉</div>
                <h2 id="successMessage">Congratulations!</h2>
                <p class="game-success-message" id="successSubtext">You successfully completed your task!</p>

                <div class="game-success-stats" id="successStats">
                    <p>Final Stress Level: 25%</p>
                    <p>Zen Points Remaining: 75</p>
                    <p>Steps Completed: 5/5</p>
                </div>

                <div class="success-actions">
                    <button id="continueToShopBtn" onclick="openShop()" class="hidden">Visit Shop</button>
                    <button id="continueCampaignBtn" onclick="returnToCampaign()" class="hidden">Continue
                        Campaign</button>
                    <button id="playAgainBtn" onclick="restartGame()">Play Again</button>
                </div>
            </div>
        </div>

        <!-- Upgrade Shop -->
        <div class="upgrade-shop hidden" id="upgradeShop">
            <div class="shop-content">
                <h2>🧘 Mindfulness Upgrades</h2>
                <p>Spend your remaining zen points to upgrade your deck for future challenges!</p>

                <div class="zen-balance">
                    <h3>💎 Zen Points: <span id="shopZenPoints">0</span></h3>
                </div>

                <div class="upgrade-options">
                    <!-- Deck Upgrades -->
                    <div class="upgrade-section">
                        <h3>🃏 Deck Upgrades</h3>
                        <div class="upgrade-card" id="jokerUpgradeCard">
                            <div class="upgrade-icon">🃏</div>
                            <h3>Add Joker to Deck</h3>
                            <p>Replace a random card with a Wild Joker. Jokers automatically calculate the perfect value
                                (1-11) to help you reach 21 or avoid busting!</p>
                            <div class="upgrade-stats">
                                <div class="cost">Cost: <span id="jokerUpgradeCost">75</span> Zen Points</div>
                                <div class="benefit">Current Jokers: <span id="currentJokers">0</span></div>
                            </div>
                            <button onclick="purchaseJokerUpgrade()" id="jokerUpgradeBtn" class="upgrade-btn">Purchase
                                Joker</button>
                        </div>
                    </div>

                    <!-- Premium Activities -->
                    <div class="upgrade-section">
                        <h3>🧘 Premium Activities</h3>
                        <div class="upgrade-card premium-activity" id="mindfulBreathingCard">
                            <div class="upgrade-icon">🌸</div>
                            <h3>Mindful Breathing</h3>
                            <p>Advanced breathing technique that combines deep breathing with focused awareness for
                                maximum stress relief (50% reduction).</p>
                            <div class="upgrade-stats">
                                <div class="cost">Cost: <span id="mindfulBreathingCost">1000</span> Zen Points</div>
                                <div class="benefit">Status: <span id="mindfulBreathingStatus">Locked</span></div>
                            </div>
                            <button onclick="purchasePremiumActivityWrapper('mindfulBreathing')"
                                id="mindfulBreathingBtn" class="upgrade-btn">Unlock Activity</button>
                        </div>

                        <div class="upgrade-card premium-activity" id="compartmentalizeCard">
                            <div class="upgrade-icon">🧠</div>
                            <h3>Compartmentalize</h3>
                            <p>Advanced psychological technique that allows you to recover from bust situations by
                                breaking them down into manageable components.</p>
                            <div class="upgrade-stats">
                                <div class="cost">Cost: <span id="compartmentalizeCost">2000</span> Zen Points</div>
                                <div class="benefit">Status: <span id="compartmentalizeStatus">Locked</span></div>
                            </div>
                            <button onclick="purchasePremiumActivityWrapper('compartmentalize')"
                                id="compartmentalizeBtn" class="upgrade-btn">Unlock Activity</button>
                        </div>
                    </div>
                </div>

                <div class="shop-actions">
                    <button onclick="continueCampaign()" class="primary-btn">Continue Campaign</button>
                    <button onclick="closeShopToCampaign()" class="secondary-btn">Close Shop</button>
                </div>
            </div>
        </div>

        <!-- Mind Palace Modal -->
        <div class="mind-palace-modal hidden" id="mindPalaceModal" role="dialog" aria-modal="true"
            aria-labelledby="mindPalaceTitle">
            <div class="mind-palace-backdrop" id="mindPalaceBackdrop"></div>
            <div class="mind-palace-content">
                <div class="mind-palace-header">
                    <h2 id="mindPalaceTitle">🧠 Your Mind Palace</h2>
                    <button class="mind-palace-close-btn" id="mindPalaceCloseBtn"
                        aria-label="Close mind palace">×</button>
                </div>
                <div class="mind-palace-body">
                    <!-- Deck Composition Section -->
                    <div class="mind-palace-section">
                        <h3>🃏 Your Mental Deck</h3>
                        <p class="section-description">The cards in your mental toolkit for handling stress</p>
                        <div class="deck-stats">
                            <div class="card-type-stat">
                                <div class="card-type-icon">🃏</div>
                                <div class="card-type-info">
                                    <h4>Wild Jokers</h4>
                                    <p class="card-count" id="jokerCount">0</p>
                                    <p class="card-description">Intelligent cards that automatically calculate the
                                        perfect
                                        value</p>
                                </div>
                            </div>
                            <div class="card-type-stat">
                                <div class="card-type-icon">🂡</div>
                                <div class="card-type-info">
                                    <h4>Aces</h4>
                                    <p class="card-count" id="aceCount">4</p>
                                    <p class="card-description">Flexible cards worth 1 or 11</p>
                                </div>
                            </div>
                            <div class="card-type-stat">
                                <div class="card-type-icon">🂠</div>
                                <div class="card-type-info">
                                    <h4>Regular Cards</h4>
                                    <p class="card-count" id="regularCount">48</p>
                                    <p class="card-description">Standard playing cards with fixed values</p>
                                </div>
                            </div>
                        </div>

                        <div class="deck-power-section">
                            <h4>🔥 Mental Deck Power</h4>
                            <div class="power-meter">
                                <div class="power-fill" id="deckPowerFill"></div>
                            </div>
                            <p id="deckPowerText">Power Level: 8% (4 special cards out of 52)</p>
                        </div>
                    </div>

                    <!-- Premium Activities Section -->
                    <div class="mind-palace-section">
                        <h3>🧘 Your Stress Management Techniques</h3>
                        <p class="section-description">Advanced techniques you've mastered for handling difficult
                            situations</p>

                        <!-- Basic Activities -->
                        <div class="activity-category">
                            <h4>🌟 Basic Techniques (Always Available)</h4>
                            <div class="activity-grid">
                                <div class="activity-item basic-activity">
                                    <div class="activity-icon">🌬️</div>
                                    <div class="activity-info">
                                        <h5>Deep Breath</h5>
                                        <p class="activity-cost">10 zen points • -10% stress</p>
                                        <p class="activity-desc">A quick breathing exercise to center yourself</p>
                                    </div>
                                </div>
                                <div class="activity-item basic-activity">
                                    <div class="activity-icon">🤸</div>
                                    <div class="activity-info">
                                        <h5>Quick Stretch</h5>
                                        <p class="activity-cost">25 zen points • -20% stress</p>
                                        <p class="activity-desc">Gentle stretching to release physical tension</p>
                                    </div>
                                </div>
                                <div class="activity-item basic-activity">
                                    <div class="activity-icon">🧘</div>
                                    <div class="activity-info">
                                        <h5>Mini Meditation</h5>
                                        <p class="activity-cost">50 zen points • -35% stress</p>
                                        <p class="activity-desc">Brief mindfulness practice for mental clarity</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Premium Activities -->
                        <div class="activity-category">
                            <h4>✨ Advanced Techniques</h4>
                            <div class="activity-grid" id="premiumActivitiesGrid">
                                <div class="activity-item premium-activity" id="mindfulBreathingActivity">
                                    <div class="activity-icon">🌸</div>
                                    <div class="activity-info">
                                        <h5>Mindful Breathing</h5>
                                        <p class="activity-cost">75 zen points • -50% stress</p>
                                        <p class="activity-desc">Advanced breathing technique with focused awareness</p>
                                        <p class="activity-status" id="mindfulBreathingActivityStatus">🔒 Locked</p>
                                    </div>
                                </div>
                                <div class="activity-item premium-activity" id="compartmentalizeActivity">
                                    <div class="activity-icon">🧠</div>
                                    <div class="activity-info">
                                        <h5>Compartmentalize</h5>
                                        <p class="activity-cost">100 zen points • Bust Recovery</p>
                                        <p class="activity-desc">Split overwhelming situations into manageable parts</p>
                                        <p class="activity-status" id="compartmentalizeActivityStatus">🔒 Locked</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upgrade History Section -->
                    <div class="mind-palace-section">
                        <h3>📈 Your Growth Journey</h3>
                        <p class="section-description">Track your progress in developing mental resilience</p>
                        <div id="upgradeHistoryContent">
                            <p>Base deck: 4 Aces + 48 Regular Cards</p>
                        </div>
                    </div>
                </div>
                <div class="mind-palace-actions">
                    <button onclick="closeMindPalace()" class="primary-btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="help-modal hidden" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
            <div class="help-modal-backdrop" id="helpModalBackdrop"></div>
            <div class="help-modal-content">
                <div class="help-modal-header">
                    <h2 id="helpModalTitle">🎮 How to Play SoberLife III</h2>
                    <button class="help-close-btn" id="helpCloseBtn" aria-label="Close help modal">×</button>
                </div>
                <div class="help-modal-body" id="helpModalBody">
                    <div class="help-section">
                        <h3>🎯 Game Objective</h3>
                        <p><strong>Single Task Mode:</strong> Successfully complete your DMV visit by managing stress
                            and winning blackjack rounds for each step.</p>
                        <p><strong>Campaign Mode:</strong> Progress through multiple stress management scenarios,
                            upgrading your deck between tasks to become more mindful and capable.</p>
                    </div>

                    <div class="help-section">
                        <h3>🃏 Blackjack Rules</h3>
                        <ul>
                            <li>Get as close to 21 as possible without going over</li>
                            <li>Number cards = face value, Face cards = 10, Aces = 1 or 11</li>
                            <li><strong>Wild Jokers = 1-11 (automatically calculated for optimal play)</strong></li>
                            <li>Click "Hit" to draw another card</li>
                            <li>Click "Stand" to keep your current total</li>
                            <li>Beat the house to advance to the next step</li>
                        </ul>
                    </div>
                    <!-- Button to show Nirvana Mode -->
                    <div class="help-section">
                        <button id="showNirvanaBtn" class="secondary-btn" style="margin-bottom:10px;">Show Nirvana
                            Mode</button>
                    </div>
                    <!-- Nirvana Mode (hidden debug zone) -->
                    <div class="help-section nirvana-zone" style="display:none;">
                        <h3>🧘 Nirvana Mode</h3>
                        <button id="nirvanaZenBtn" class="primary-btn">Add 1000 Zen Points (Debug)</button>
                        <p style="font-size:smaller;opacity:0.7;">For debugging: instantly add zen points for shop
                            testing.</p>
                    </div>

                    <div class="help-section">
                        <h3>😰 Stress Management</h3>
                        <ul>
                            <li>Your stress level increases when you lose rounds</li>
                            <li>Reaching 100% stress = game over</li>
                            <li>Use zen activities to reduce stress:</li>
                            <li class="zen-activity">🌬️ Deep Breath: 10 zen points • -10% stress</li>
                            <li class="zen-activity">🤸 Quick Stretch: 25 zen points • -20% stress</li>
                            <li class="zen-activity">🧘 Mini Meditation: 50 zen points • -35% stress</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>🎯 Campaign Mode</h3>
                        <p>In Campaign Mode, you'll progress through multiple stress management scenarios:</p>
                        <ul>
                            <li><strong>DMV License Renewal:</strong> Navigate bureaucratic processes</li>
                            <li><strong>Job Interview:</strong> Handle performance anxiety and professional pressure
                            </li>
                            <li><strong>Deck Upgrades:</strong> Spend zen points to add Wild Jokers to your deck</li>
                            <li><strong>Progressive Difficulty:</strong> Later tasks unlock as you complete earlier ones
                            </li>
                            <li><strong>Shop Access:</strong> Visit the shop anytime from the campaign overview</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>🃏 Wild Joker Cards</h3>
                        <ul>
                            <li><strong>Intelligent Value:</strong> Jokers automatically calculate the perfect value
                                (1-11) for your hand</li>
                            <li><strong>Perfect 21:</strong> If you need 6 to reach 21, the Joker becomes 6</li>
                            <li><strong>Bust Prevention:</strong> If you'd bust, the Joker becomes 1 to save you</li>
                            <li><strong>Visual Effects:</strong> Jokers have rainbow animations and show their
                                calculated value</li>
                            <li><strong>Celebration:</strong> Special effects when Jokers help you achieve perfect
                                scores</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>🛒 Upgrade Shop</h3>
                        <ul>
                            <li>Access the shop from the campaign overview or after completing tasks</li>
                            <li><strong>Purchase Jokers:</strong> Add Wild Joker cards to your deck for superior
                                gameplay</li>
                            <li>Cost increases with each purchase (starts at 75 zen points)</li>
                            <li>Your upgraded deck carries over to all future tasks</li>
                            <li><strong>Mind Palace:</strong> Click "Visit Mind Palace" to see your current deck
                                composition, available stress management techniques, and upgrade history</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>⌨️ Keyboard Shortcuts</h3>
                        <ul>
                            <li><strong>H</strong> - Hit (take another card)</li>
                            <li><strong>S</strong> - Stand (keep current total)</li>
                            <li><strong>N</strong> - Next Step (when available)</li>
                            <li><strong>?</strong> or <strong>/</strong> - Show/hide this help</li>
                            <li><strong>ESC</strong> - Close help modal</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>💡 Tips for Success</h3>
                        <ul>
                            <li>Use zen activities strategically - don't wait until stress is too high</li>
                            <li>Remember basic blackjack strategy: stand on 17+, be careful with 12-16</li>
                            <li>Your initial survey affects starting stress level</li>
                            <li><strong>Campaign Mode:</strong> Save zen points for Wild Joker upgrades between tasks
                            </li>
                            <li><strong>Campaign Mode:</strong> More Jokers = intelligent plays and better odds</li>
                            <li><strong>Joker Strategy:</strong> Jokers automatically calculate the best value - trust
                                their intelligence!</li>
                            <li>Each task teaches different stress management techniques</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript Files -->
    <script type="module" src="assets/js/main.js"></script>
    <script>
        // Wait for modules to load, then assign functions to global scope
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('DOM loaded, importing functions...');

            try {
                // Dynamic imports to ensure modules are loaded
                const stressModule = await import('./assets/js/stress-system.js');
                const mainModule = await import('./assets/js/main.js');
                const campaignModule = await import('./assets/js/campaign-manager.js');
                const shopModule = await import('./assets/js/shop-system.js');

                // Assign functions to global scope
                window.useZenActivity = stressModule.useZenActivity;
                window.startSingleTaskMode = mainModule.startSingleTaskMode;
                window.startCampaignMode = mainModule.startCampaignMode;
                window.startTask = mainModule.startTask;
                window.startGame = mainModule.startTask;
                window.hit = mainModule.hit;
                window.stand = mainModule.stand;
                window.nextStep = mainModule.nextStep;
                window.restartGame = mainModule.restartGame;
                window.showHelp = mainModule.showHelp;
                window.enableGameControls = mainModule.enableGameControls;
                window.openCampaignShop = mainModule.openCampaignShop;
                window.openShop = mainModule.openShopWithZen;
                window.purchaseJokerUpgrade = mainModule.purchaseJoker;
                window.continueCampaign = mainModule.continueCampaign;
                window.closeShopToCampaign = mainModule.closeShopToCampaign;
                window.visitMindPalace = mainModule.visitMindPalace;
                window.closeMindPalace = mainModule.closeMindPalace;
                window.startCampaignTask = campaignModule.startCampaignTask;
                window.resetCampaign = campaignModule.resetCampaign;
                window.returnToCampaign = campaignModule.returnToCampaign;
                window.switchSplitHandWrapper = mainModule.switchSplitHandWrapper;
                window.completeBothHandsWrapper = mainModule.completeBothHandsWrapper;
                window.useCompartmentalizeWrapper = mainModule.useCompartmentalizeWrapper;
                window.declineCompartmentalize = mainModule.declineCompartmentalize;
                window.purchasePremiumActivityWrapper = shopModule.purchasePremiumActivityWrapper;

                console.log('✅ All functions loaded successfully!');
                console.log('startCampaignMode:', typeof window.startCampaignMode);
                console.log('startSingleTaskMode:', typeof window.startSingleTaskMode);

                // Add event listener for Show Nirvana Mode button
                const showNirvanaBtn = document.getElementById('showNirvanaBtn');
                if (showNirvanaBtn) {
                    showNirvanaBtn.addEventListener('click', function () {
                        const nirvanaZone = document.querySelector('.nirvana-zone');
                        if (nirvanaZone) {
                            nirvanaZone.style.display = 'block';
                            showNirvanaBtn.style.display = 'none';

                            // Set up the nirvana zen button click handler
                            const nirvanaZenBtn = document.getElementById('nirvanaZenBtn');
                            if (nirvanaZenBtn && window.addZenPointsDebug) {
                                nirvanaZenBtn.onclick = window.addZenPointsDebug;
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('❌ Error loading functions:', error);

                // Fallback: show error message to user
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    right: 20px;
                    background: #ff4444;
                    color: white;
                    padding: 15px;
                    border-radius: 8px;
                    z-index: 9999;
                    font-family: Arial, sans-serif;
                `;
                errorDiv.innerHTML = `
                    <strong>⚠️ Game Loading Error</strong><br>
                    The game failed to load properly. Please refresh the page.<br>
                    <small>Error: ${error.message}</small>
                `;
                document.body.appendChild(errorDiv);
            }
        });
    </script>
</body>

</html>