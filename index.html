<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧘 SoberLife - III 🧘</title>
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
</head>

<body>
    <div class="game-container">
        <div class="game-header">
            <h1>🧘 SoberLife - III 🧘</h1>
            <button class="help-btn" id="helpBtn" onclick="showHelp()" aria-label="Show game help and instructions" tabindex="0">
                <span class="help-icon">?</span>
                <span class="help-text">Help</span>
            </button>
        </div>

        <!-- Avatar and Stress Meter -->
        <div class="avatar-container">
            <div class="avatar" id="avatar">😊</div>
            <div>
                <div>Stress Level</div>
                <div class="stress-meter">
                    <div class="stress-fill" id="stressFill"></div>
                </div>
                <div class="zen-points" id="zenPoints">Zen Points: 100</div>
            </div>
        </div>

        <!-- Survey Section -->
        <div class="survey" id="surveySection">
            <h3>Pre-Task Assessment</h3>
            <p>Before we begin your DMV visit, let's assess your current stress level:</p>

            <div class="survey-question">
                <strong>How did you sleep last night?</strong>
                <label><input type="radio" name="sleep" value="0"> Great! 8+ hours of solid sleep</label>
                <label><input type="radio" name="sleep" value="10"> Pretty well, 6-8 hours</label>
                <label><input type="radio" name="sleep" value="20"> Not great, 4-6 hours</label>
                <label><input type="radio" name="sleep" value="30"> Terrible, less than 4 hours</label>
            </div>

            <div class="survey-question">
                <strong>How prepared do you feel for the DMV?</strong>
                <label><input type="radio" name="prepared" value="0"> Very prepared, all documents ready</label>
                <label><input type="radio" name="prepared" value="10"> Mostly prepared</label>
                <label><input type="radio" name="prepared" value="20"> Somewhat prepared</label>
                <label><input type="radio" name="prepared" value="30"> Not prepared at all</label>
            </div>

            <div class="survey-question">
                <strong>How's your day been so far?</strong>
                <label><input type="radio" name="day" value="0"> Amazing, everything's going smoothly</label>
                <label><input type="radio" name="day" value="10"> Pretty good</label>
                <label><input type="radio" name="day" value="20"> Okay, some minor issues</label>
                <label><input type="radio" name="day" value="30"> Stressful, lots of problems</label>
            </div>

            <div id="surveyError" style="color: red; font-weight: bold; margin: 10px 0; display: none;">
                Please answer all questions before beginning your DMV visit!
            </div>
            <button id="startGameBtn" onclick="startGame()" disabled>Begin DMV Visit</button>
        </div>

        <!-- Task Info -->
        <div class="task-info hidden" id="taskInfo">
            <div class="step-indicator" id="stepIndicator">Step 1 of 5</div>
            <h3>🏛️ Task: DMV License Renewal & Real ID</h3>
            <p id="taskDescription">Step 1: Check in at the front desk</p>
        </div>

        <!-- Zen Activities Panel -->
        <div class="zen-activities hidden" id="zenActivities">
            <h3>🧘 Stress Relief Activities</h3>
            <p>Use your zen points to manage stress during your DMV visit:</p>
            <div class="activity-buttons">
                <button class="activity-btn" onclick="useZenActivity('breath')" id="breathBtn">
                    🌬️ Deep Breath<br>
                    <small>10 zen points • -10% stress</small>
                </button>
                <button class="activity-btn" onclick="useZenActivity('stretch')" id="stretchBtn">
                    🤸 Quick Stretch<br>
                    <small>25 zen points • -20% stress</small>
                </button>
                <button class="activity-btn" onclick="useZenActivity('meditation')" id="meditationBtn">
                    🧘 Mini Meditation<br>
                    <small>50 zen points • -35% stress</small>
                </button>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area hidden" id="gameArea">
            <div class="cards-container">
                <div class="player-area">
                    <h3>You</h3>
                    <div class="cards" id="playerCards"></div>
                    <div class="score" id="playerScore">Score: 0</div>
                </div>
                <div class="house-area">
                    <h3>House</h3>
                    <div class="cards" id="houseCards"></div>
                    <div class="score" id="houseScore">Score: ?</div>
                </div>
            </div>

            <div class="buttons">
                <button id="hitBtn" onclick="hit()">Hit</button>
                <button id="standBtn" onclick="stand()">Stand</button>
                <button id="nextStepBtn" onclick="nextStep()" class="hidden">Next Step</button>
            </div>

            <div id="roundResult"></div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over hidden" id="gameOverScreen">
            <div class="game-over-content">
                <div class="game-over-avatar">🤯</div>
                <h2>STRESS OVERLOAD!</h2>
                <p class="game-over-message">You've reached maximum stress levels and had a complete meltdown at the DMV!</p>
                <p class="game-over-subtext">Don't worry, it happens to the best of us. The DMV is basically designed to test human patience limits.</p>
                
                <div class="game-over-stats">
                    <p>Final Stress Level: <span id="finalStressLevel">100%</span></p>
                    <p>Zen Points Remaining: <span id="finalZenPoints">0</span></p>
                    <p>DMV Steps Completed: <span id="stepsCompleted">0</span>/5</p>
                </div>
                
                <button id="tryAgainBtn" onclick="restartGame()">Try Again</button>
            </div>
        </div>

        <!-- Game Success Screen -->
        <div class="game-success hidden" id="gameSuccessScreen">
            <div class="game-success-content">
                <div class="game-success-avatar">🎉</div>
                <h2 id="successMessage">Congratulations!</h2>
                <p class="game-success-message" id="successSubtext">You successfully completed your DMV visit!</p>
                
                <div class="game-success-stats" id="successStats">
                    <p>Final Stress Level: 25%</p>
                    <p>Zen Points Remaining: 75</p>
                    <p>DMV Steps Completed: 5/5</p>
                </div>
                
                <button id="playAgainBtn" onclick="restartGame()">Play Again</button>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="help-modal hidden" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
            <div class="help-modal-backdrop" id="helpModalBackdrop"></div>
            <div class="help-modal-content">
                <div class="help-modal-header">
                    <h2 id="helpModalTitle">🎮 How to Play SoberLife III</h2>
                    <button class="help-close-btn" id="helpCloseBtn" aria-label="Close help modal">×</button>
                </div>
                <div class="help-modal-body" id="helpModalBody">
                    <div class="help-section">
                        <h3>🎯 Game Objective</h3>
                        <p>Successfully complete your DMV visit by managing stress and winning blackjack rounds for each step.</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>🃏 Blackjack Rules</h3>
                        <ul>
                            <li>Get as close to 21 as possible without going over</li>
                            <li>Number cards = face value, Face cards = 10, Aces = 1 or 11</li>
                            <li>Click "Hit" to draw another card</li>
                            <li>Click "Stand" to keep your current total</li>
                            <li>Beat the house to advance to the next DMV step</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>😰 Stress Management</h3>
                        <ul>
                            <li>Your stress level increases when you lose rounds</li>
                            <li>Reaching 100% stress = game over</li>
                            <li>Use zen activities to reduce stress:</li>
                            <li class="zen-activity">🌬️ Deep Breath: 10 zen points • -10% stress</li>
                            <li class="zen-activity">🤸 Quick Stretch: 25 zen points • -20% stress</li>
                            <li class="zen-activity">🧘 Mini Meditation: 50 zen points • -35% stress</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>🏛️ DMV Steps</h3>
                        <ol>
                            <li>Check in at the front desk</li>
                            <li>Wait in line for your number to be called</li>
                            <li>Submit your paperwork and documents</li>
                            <li>Take your photo and eye exam</li>
                            <li>Pay fees and receive your new license</li>
                        </ol>
                    </div>
                    
                    <div class="help-section">
                        <h3>⌨️ Keyboard Shortcuts</h3>
                        <ul>
                            <li><strong>H</strong> - Hit (take another card)</li>
                            <li><strong>S</strong> - Stand (keep current total)</li>
                            <li><strong>N</strong> - Next Step (when available)</li>
                            <li><strong>?</strong> or <strong>/</strong> - Show/hide this help</li>
                            <li><strong>ESC</strong> - Close help modal</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>💡 Tips for Success</h3>
                        <ul>
                            <li>Use zen activities strategically - don't wait until stress is too high</li>
                            <li>Remember basic blackjack strategy: stand on 17+, be careful with 12-16</li>
                            <li>Your initial survey affects starting stress level</li>
                            <li>Complete all 5 DMV steps to win the game</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript Files -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module">
        // Import zen activity function for global access
        import { useZenActivity } from './assets/js/stress-system.js';
        window.useZenActivity = useZenActivity;
    </script>
</body>

</html>