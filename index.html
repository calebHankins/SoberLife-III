<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧘 SoberLife - III 🧘</title>
    
    <!-- External CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
</head>

<body>
    <div class="game-container">
        <div class="game-header">
            <h1>🧘 SoberLife - III 🧘</h1>
            <button class="help-btn" id="helpBtn" onclick="showHelp()" aria-label="Show game help and instructions" tabindex="0">
                <span class="help-icon">?</span>
                <span class="help-text">Help</span>
            </button>
        </div>

        <!-- Avatar and Stress Meter -->
        <div class="avatar-container">
            <div class="avatar" id="avatar">😊</div>
            <div>
                <div>Stress Level</div>
                <div class="stress-meter">
                    <div class="stress-fill" id="stressFill"></div>
                </div>
                <div class="zen-points" id="zenPoints">Zen Points: 100</div>
            </div>
        </div>

        <!-- Game Mode Selection -->
        <div class="game-mode-selection" id="gameModeSelection">
            <h3>Choose Your Experience</h3>
            <p>How would you like to practice stress management?</p>
            
            <div class="mode-options">
                <div class="mode-card">
                    <h4>🏛️ Single Task Mode</h4>
                    <p>Practice with just the DMV scenario</p>
                    <button onclick="startSingleTaskMode()" class="mode-btn">Start DMV Challenge</button>
                </div>
                
                <div class="mode-card">
                    <h4>🎯 Campaign Mode</h4>
                    <p>Progress through multiple scenarios and upgrade your deck</p>
                    <button onclick="startCampaignMode()" class="mode-btn">Start Campaign</button>
                </div>
            </div>
        </div>

        <!-- Campaign Overview -->
        <div class="campaign-overview hidden" id="campaignOverview">
            <h2>🎯 Stress Management Campaign</h2>
            
            <div class="campaign-progress">
                <div class="deck-status">
                    <h4>🃏 Your Deck Power</h4>
                    <p id="deckComposition">Aces: 4 / 52 Cards</p>
                </div>
                <div class="total-progress">
                    <h4>📊 Campaign Progress</h4>
                    <p id="campaignProgress">Tasks Completed: 0/2</p>
                </div>
            </div>
            
            <div class="task-list" id="taskList">
                <!-- Task cards will be populated by JavaScript -->
            </div>
            
            <div class="campaign-actions">
                <button onclick="resetCampaign()" class="secondary-btn">Reset Campaign</button>
            </div>
        </div>

        <!-- Survey Section -->
        <div class="survey hidden" id="surveySection">
            <h3>Pre-Task Assessment</h3>
            <p id="surveyDescription">Before we begin your task, let's assess your current stress level:</p>

            <div class="survey-question">
                <strong>How did you sleep last night?</strong>
                <label><input type="radio" name="sleep" value="0"> Great! 8+ hours of solid sleep</label>
                <label><input type="radio" name="sleep" value="10"> Pretty well, 6-8 hours</label>
                <label><input type="radio" name="sleep" value="20"> Not great, 4-6 hours</label>
                <label><input type="radio" name="sleep" value="30"> Terrible, less than 4 hours</label>
            </div>

            <div class="survey-question">
                <strong id="preparedQuestion">How prepared do you feel for this task?</strong>
                <label><input type="radio" name="prepared" value="0"> Very prepared, ready to go</label>
                <label><input type="radio" name="prepared" value="10"> Mostly prepared</label>
                <label><input type="radio" name="prepared" value="20"> Somewhat prepared</label>
                <label><input type="radio" name="prepared" value="30"> Not prepared at all</label>
            </div>

            <div class="survey-question">
                <strong>How's your day been so far?</strong>
                <label><input type="radio" name="day" value="0"> Amazing, everything's going smoothly</label>
                <label><input type="radio" name="day" value="10"> Pretty good</label>
                <label><input type="radio" name="day" value="20"> Okay, some minor issues</label>
                <label><input type="radio" name="day" value="30"> Stressful, lots of problems</label>
            </div>

            <div id="surveyError" style="color: red; font-weight: bold; margin: 10px 0; display: none;">
                Please answer all questions before beginning your task!
            </div>
            <button id="startTaskBtn" onclick="startTask()" disabled>Begin Task</button>
        </div>

        <!-- Task Info -->
        <div class="task-info hidden" id="taskInfo">
            <div class="step-indicator" id="stepIndicator">Step 1 of 5</div>
            <h3>🏛️ Task: DMV License Renewal & Real ID</h3>
            <p id="taskDescription">Step 1: Check in at the front desk</p>
        </div>

        <!-- Zen Activities Panel -->
        <div class="zen-activities hidden" id="zenActivities">
            <h3>🧘 Stress Relief Activities</h3>
            <p>Use your zen points to manage stress during your DMV visit:</p>
            <div class="activity-buttons">
                <button class="activity-btn" onclick="useZenActivity('breath')" id="breathBtn">
                    🌬️ Deep Breath<br>
                    <small>10 zen points • -10% stress</small>
                </button>
                <button class="activity-btn" onclick="useZenActivity('stretch')" id="stretchBtn">
                    🤸 Quick Stretch<br>
                    <small>25 zen points • -20% stress</small>
                </button>
                <button class="activity-btn" onclick="useZenActivity('meditation')" id="meditationBtn">
                    🧘 Mini Meditation<br>
                    <small>50 zen points • -35% stress</small>
                </button>
            </div>
        </div>

        <!-- Game Area -->
        <div class="game-area hidden" id="gameArea">
            <div class="cards-container">
                <div class="player-area">
                    <h3>You</h3>
                    <div class="cards" id="playerCards"></div>
                    <div class="score" id="playerScore">Score: 0</div>
                </div>
                <div class="house-area">
                    <h3>House</h3>
                    <div class="cards" id="houseCards"></div>
                    <div class="score" id="houseScore">Score: ?</div>
                </div>
            </div>

            <div class="buttons">
                <button id="hitBtn" onclick="hit()">Hit</button>
                <button id="standBtn" onclick="stand()">Stand</button>
                <button id="nextStepBtn" onclick="nextStep()" class="hidden">Next Step</button>
            </div>

            <div id="roundResult"></div>
        </div>

        <!-- Game Over Screen -->
        <div class="game-over hidden" id="gameOverScreen">
            <div class="game-over-content">
                <div class="game-over-avatar">🤯</div>
                <h2>STRESS OVERLOAD!</h2>
                <p class="game-over-message">You've reached maximum stress levels and had a complete meltdown at the DMV!</p>
                <p class="game-over-subtext">Don't worry, it happens to the best of us. The DMV is basically designed to test human patience limits.</p>
                
                <div class="game-over-stats">
                    <p>Final Stress Level: <span id="finalStressLevel">100%</span></p>
                    <p>Zen Points Remaining: <span id="finalZenPoints">0</span></p>
                    <p>DMV Steps Completed: <span id="stepsCompleted">0</span>/5</p>
                </div>
                
                <button id="tryAgainBtn" onclick="restartGame()">Try Again</button>
            </div>
        </div>

        <!-- Game Success Screen -->
        <div class="game-success hidden" id="gameSuccessScreen">
            <div class="game-success-content">
                <div class="game-success-avatar">🎉</div>
                <h2 id="successMessage">Congratulations!</h2>
                <p class="game-success-message" id="successSubtext">You successfully completed your task!</p>
                
                <div class="game-success-stats" id="successStats">
                    <p>Final Stress Level: 25%</p>
                    <p>Zen Points Remaining: 75</p>
                    <p>Steps Completed: 5/5</p>
                </div>
                
                <div class="success-actions">
                    <button id="continueToShopBtn" onclick="openShop()" class="hidden">Visit Shop</button>
                    <button id="continueCampaignBtn" onclick="returnToCampaign()" class="hidden">Continue Campaign</button>
                    <button id="playAgainBtn" onclick="restartGame()">Play Again</button>
                </div>
            </div>
        </div>

        <!-- Upgrade Shop -->
        <div class="upgrade-shop hidden" id="upgradeShop">
            <div class="shop-content">
                <h2>🧘 Mindfulness Upgrades</h2>
                <p>Spend your remaining zen points to upgrade your deck for future challenges!</p>
                
                <div class="zen-balance">
                    <h3>💎 Zen Points: <span id="shopZenPoints">0</span></h3>
                </div>
                
                <div class="upgrade-options">
                    <div class="upgrade-card" id="aceUpgradeCard">
                        <div class="upgrade-icon">🃏</div>
                        <h3>Add Ace to Deck</h3>
                        <p>Replace a random card with an Ace. Aces can be 1 or 11, making them incredibly valuable for any situation.</p>
                        <div class="upgrade-stats">
                            <div class="cost">Cost: <span id="aceUpgradeCost">50</span> Zen Points</div>
                            <div class="benefit">Current Aces: <span id="currentAces">4</span></div>
                        </div>
                        <button onclick="purchaseAceUpgrade()" id="aceUpgradeBtn" class="upgrade-btn">Purchase Ace</button>
                    </div>
                </div>
                
                <div class="shop-actions">
                    <button onclick="continueCampaign()" class="primary-btn">Continue Campaign</button>
                    <button onclick="skipShop()" class="secondary-btn">Skip Upgrades</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="help-modal hidden" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
            <div class="help-modal-backdrop" id="helpModalBackdrop"></div>
            <div class="help-modal-content">
                <div class="help-modal-header">
                    <h2 id="helpModalTitle">🎮 How to Play SoberLife III</h2>
                    <button class="help-close-btn" id="helpCloseBtn" aria-label="Close help modal">×</button>
                </div>
                <div class="help-modal-body" id="helpModalBody">
                    <div class="help-section">
                        <h3>🎯 Game Objective</h3>
                        <p><strong>Single Task Mode:</strong> Successfully complete your DMV visit by managing stress and winning blackjack rounds for each step.</p>
                        <p><strong>Campaign Mode:</strong> Progress through multiple stress management scenarios, upgrading your deck between tasks to become more mindful and capable.</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>🃏 Blackjack Rules</h3>
                        <ul>
                            <li>Get as close to 21 as possible without going over</li>
                            <li>Number cards = face value, Face cards = 10, Aces = 1 or 11</li>
                            <li>Click "Hit" to draw another card</li>
                            <li>Click "Stand" to keep your current total</li>
                            <li>Beat the house to advance to the next DMV step</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>😰 Stress Management</h3>
                        <ul>
                            <li>Your stress level increases when you lose rounds</li>
                            <li>Reaching 100% stress = game over</li>
                            <li>Use zen activities to reduce stress:</li>
                            <li class="zen-activity">🌬️ Deep Breath: 10 zen points • -10% stress</li>
                            <li class="zen-activity">🤸 Quick Stretch: 25 zen points • -20% stress</li>
                            <li class="zen-activity">🧘 Mini Meditation: 50 zen points • -35% stress</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>🎯 Campaign Mode</h3>
                        <p>In Campaign Mode, you'll progress through multiple stress management scenarios:</p>
                        <ul>
                            <li><strong>DMV License Renewal:</strong> Navigate bureaucratic processes</li>
                            <li><strong>Job Interview:</strong> Handle performance anxiety and professional pressure</li>
                            <li><strong>Deck Upgrades:</strong> Spend zen points to add Aces to your deck</li>
                            <li><strong>Progressive Difficulty:</strong> Later tasks unlock as you complete earlier ones</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>🛒 Upgrade Shop</h3>
                        <ul>
                            <li>After completing tasks, visit the shop to spend remaining zen points</li>
                            <li><strong>Add Ace to Deck:</strong> Replace a random card with an Ace (cost increases with each purchase)</li>
                            <li>Aces can be worth 1 or 11, making them extremely valuable</li>
                            <li>Your upgraded deck carries over to all future tasks</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>⌨️ Keyboard Shortcuts</h3>
                        <ul>
                            <li><strong>H</strong> - Hit (take another card)</li>
                            <li><strong>S</strong> - Stand (keep current total)</li>
                            <li><strong>N</strong> - Next Step (when available)</li>
                            <li><strong>?</strong> or <strong>/</strong> - Show/hide this help</li>
                            <li><strong>ESC</strong> - Close help modal</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>💡 Tips for Success</h3>
                        <ul>
                            <li>Use zen activities strategically - don't wait until stress is too high</li>
                            <li>Remember basic blackjack strategy: stand on 17+, be careful with 12-16</li>
                            <li>Your initial survey affects starting stress level</li>
                            <li><strong>Campaign Mode:</strong> Save zen points for deck upgrades between tasks</li>
                            <li><strong>Campaign Mode:</strong> More Aces = better odds in future challenges</li>
                            <li>Each task teaches different stress management techniques</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External JavaScript Files -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module">
        // Import zen activity function for global access
        import { useZenActivity } from './assets/js/stress-system.js';
        window.useZenActivity = useZenActivity;
    </script>
</body>

</html>